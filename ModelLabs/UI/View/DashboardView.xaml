<UserControl x:Class="UI.View.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:UI.View"
             xmlns:root ="clr-namespace:UI"
             xmlns:converters="clr-namespace:UI.Converters"
             xmlns:i = "http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:chartingToolkit="clr-namespace:System.Windows.Controls.DataVisualization.Charting;assembly=System.Windows.Controls.DataVisualization.Toolkit"
              xmlns:MetroChart="clr-namespace:De.TorstenMandelkow.MetroChart;assembly=De.TorstenMandelkow.MetroChart"
             mc:Ignorable="d" 
             d:DesignHeight="780" d:DesignWidth="1250">
	<UserControl.Resources>
		<converters:TestConverter x:Key="TestConverter" />
		<converters:GidToMridConverter x:Key="GidToMridConverter" />
		<converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
		<converters:GidMapToVisibilityConverter x:Key="GidMapToVisibilityConverter" />
		<converters:GidMapToBoolConverter x:Key="GidMapToBoolConverter" />
		<converters:LastValueShowConverter x:Key="LastValueShowConverter" />
		<converters:BoolToColorConverter x:Key="BoolToColorConverter" />
		<Style
			x:Key = "DateTimeAxisLabelStyle2" TargetType="chartingToolkit:DateTimeAxisLabel">
			<Setter Property="RenderTransformOrigin" Value="0.80,0.20"></Setter>
			<Setter Property="RenderTransform">
				<Setter.Value>
					<RotateTransform Angle="-90"></RotateTransform>
				</Setter.Value>
			</Setter>
		</Style>
		
		<DataTemplate x:Key="GraphGeneratorTemplate" >
			<Border BorderBrush="Gray" BorderThickness="1">
				<Grid Background="LightGray" >
					<Grid.Visibility>
						<MultiBinding Converter="{StaticResource GidMapToVisibilityConverter}">
							<Binding Path="DataContext.GidToBoolMap" RelativeSource="{RelativeSource AncestorType=UserControl}"></Binding>
							<Binding Path="Key"></Binding>
						</MultiBinding>
					</Grid.Visibility>

					<!--<CheckBox  IsChecked="{Binding OnOff}" Command="{Binding DataContext.ActivateGen, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                          CommandParameter="{Binding}" Style="{StaticResource CheckBoxStyle}" Margin="2,3,0,0">
						<CheckBox.ToolTip>
							<ToolTip>
								On/off generator.
							</ToolTip>
						</CheckBox.ToolTip>
					</CheckBox>-->

					<StackPanel Background="{Binding Path=Value.Key, Converter={StaticResource BoolToColorConverter}}">
						<CheckBox IsChecked="{Binding Path=Value.Key, Mode=OneWay}" Margin="2,3,0,0">
							<CheckBox.ToolTip>
								<ToolTip>
									On/off generator.
								</ToolTip>
							</CheckBox.ToolTip>
						</CheckBox>
					</StackPanel>
					
					<Grid Width="23" Height="20" Margin="-210, -139, 0, 0">
						<Grid.ContextMenu>
							<ContextMenu>
								<MenuItem Header="Set point">
									<TextBox Tag="Input..." Style="{StaticResource placeHolder}" Height="20"  Text ="{Binding InputValue, Mode=TwoWay,  UpdateSourceTrigger=PropertyChanged}">
										<TextBox.InputBindings>
											<KeyBinding Command="{Binding DataContext.CommandGenMessBox, RelativeSource={RelativeSource AncestorType=UserControl}}" Key="Enter"  CommandParameter="{Binding}"/>
										</TextBox.InputBindings>
									</TextBox>
								</MenuItem>
                                <MenuItem x:Name="MenuItemHistory" Header="History" Click="MenuItemHistory_Click"/>
								<MenuItem Header="Fuel economy"/>
							</ContextMenu>
						</Grid.ContextMenu>
						<Ellipse Style="{StaticResource AlarmGen}" Fill="{Binding Severity}" Stroke="Black" StrokeThickness="1">
						</Ellipse>
						
						<TextBlock VerticalAlignment="Center" HorizontalAlignment="Center" Text="G" FontWeight="Bold"/>
					</Grid>
					<TextBlock Height="25" Width="50" Margin="-130, -130,0,0" Foreground="Red">
						<TextBlock.Text>
							<MultiBinding Converter="{StaticResource LastValueShowConverter}" >
								<Binding Path="Value.Value"/>
								<Binding Path="Value.Value[0].CurrentValue"></Binding>
							</MultiBinding>
						</TextBlock.Text>
					</TextBlock>
				
					<chartingToolkit:Chart Style="{StaticResource RealTimeDashboardStyle}"
									   Width="{Binding DataContext.GraphWidth,RelativeSource={RelativeSource AncestorType=UserControl}}"
									   Height="{Binding DataContext.GraphHeight,RelativeSource={RelativeSource AncestorType=UserControl}}"
                                       Template="{StaticResource GeneratorChartTemplate}"
									   >
						<!--<chartingToolkit:Chart.Tag >
							<MultiBinding Converter="{StaticResource LastValueShowConverter}" >
								<Binding Path="Value"></Binding>
								<Binding Path="Value[0].CurrentValue"></Binding>
							</MultiBinding>
						</chartingToolkit:Chart.Tag>-->
						<!--<chartingToolkit:Chart.Title>
							<MultiBinding Converter="{StaticResource GidToMridConverter}">
								<Binding Path="Key"></Binding>
								<Binding Path="DataContext.NmsModelMap" RelativeSource="{RelativeSource AncestorType={x:Type root:MainWindow}}"></Binding>
							</MultiBinding>
						</chartingToolkit:Chart.Title>-->

						<chartingToolkit:LineSeries Title="Power"
												ItemsSource="{Binding Path=Value.Value}"
												DependentValueBinding="{Binding Path=CurrentValue}"
												IndependentValueBinding="{Binding Path=TimeStamp.Second}"
												IsSelectionEnabled="False"
												Style="{StaticResource LineSeriesStyle}">
							<chartingToolkit:LineSeries.DataPointStyle>
								<Style TargetType="chartingToolkit:LineDataPoint">
									<Setter Property="Background" Value="DarkGreen" />
									<Setter Property="Template" Value="{StaticResource LineNoDataPointTemplate}" />
								</Style>
							</chartingToolkit:LineSeries.DataPointStyle>

							<chartingToolkit:LineSeries.IndependentAxis>
								<chartingToolkit:CategoryAxis Orientation="X" Title="Time (s)" />
							</chartingToolkit:LineSeries.IndependentAxis>

							<chartingToolkit:LineSeries.DependentRangeAxis>
								<chartingToolkit:LinearAxis Orientation="Y" Title="Power (kW)" Minimum="0">
								</chartingToolkit:LinearAxis>

							</chartingToolkit:LineSeries.DependentRangeAxis>
						</chartingToolkit:LineSeries>
					</chartingToolkit:Chart>
				</Grid>
			</Border>
		</DataTemplate>

		<DataTemplate x:Key="VisibilityCheckbox">
			<CheckBox Foreground="Black" Margin="1,0,0,2" >

				<CheckBox.Content>
					<MultiBinding Converter="{StaticResource GidToMridConverter}">
						<Binding Path="Key"></Binding>
						<Binding Path="DataContext.NmsModelMap" RelativeSource="{RelativeSource AncestorType={x:Type root:MainWindow}}"></Binding>
					</MultiBinding>
				</CheckBox.Content>

				<CheckBox.IsChecked>
					<MultiBinding Converter="{StaticResource GidMapToBoolConverter}" Mode="OneWay">
						<Binding Path="DataContext.GidToBoolMap" RelativeSource="{RelativeSource AncestorType=UserControl}"></Binding>
						<Binding Path="Key" Mode="OneWay"></Binding>
					</MultiBinding>
				</CheckBox.IsChecked>
				<i:Interaction.Triggers>
					<i:EventTrigger EventName="Checked">
						<i:InvokeCommandAction Command="{Binding DataContext.VisibilityCheckedCommand,RelativeSource={RelativeSource AncestorType=UserControl}}"
											   CommandParameter="{Binding Key}" />
					</i:EventTrigger>
					<i:EventTrigger EventName="Unchecked">
						<i:InvokeCommandAction Command="{Binding DataContext.VisibilityUncheckedCommand,RelativeSource={RelativeSource AncestorType=UserControl}}"
											   CommandParameter="{Binding Key}" />
					</i:EventTrigger>
				</i:Interaction.Triggers>
			</CheckBox>
		</DataTemplate>

		<DataTemplate x:Key="GraphTotalGeneration">
			<Grid Width="1000">
				<TextBlock TextWrapping="WrapWithOverflow">
                        <chartingToolkit:Chart Grid.Row="2" Margin="10" Title="Total Production" Style="{StaticResource DashboardChartStyle}" Height="600" Width="980">
						
                            <chartingToolkit:LineSeries ItemsSource="{Binding Path=GenerationList}" 
												DependentValueBinding="{Binding Path=Value}" 
												IndependentValueBinding="{Binding Path=Key}"
												IsSelectionEnabled="False"
												Style="{StaticResource LineSeriesStyle}"
                                                Title="Total Generation [kW]"
                                                >
                                <chartingToolkit:LineSeries.DataPointStyle>
                                    <Style TargetType="chartingToolkit:LineDataPoint">
                                        <Setter Property="Background" Value="DarkGreen"/>
                                        <Setter Property="Template" Value="{StaticResource LineDataPointPowerTemplate}"/>
                                    </Style>
                                </chartingToolkit:LineSeries.DataPointStyle>
								
                                <!--<chartingToolkit:LineSeries.IndependentAxis>
                                    <chartingToolkit:DateTimeAxis GridLineStyle="{StaticResource lineStyle}" Orientation="X" Title="Time"  />
                                </chartingToolkit:LineSeries.IndependentAxis>

                                <chartingToolkit:LineSeries.DependentRangeAxis>
                                    <chartingToolkit:LinearAxis GridLineStyle="{StaticResource lineStyle}"  Orientation="Y" Title="Power (kW)" Minimum="0"/>
                                </chartingToolkit:LineSeries.DependentRangeAxis>-->
                            </chartingToolkit:LineSeries>
                        </chartingToolkit:Chart>
				</TextBlock>
			</Grid>
		</DataTemplate>

        <DataTemplate x:Key="MetroChartTemplate">
            
        </DataTemplate>
	</UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid>

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />

            </Grid.RowDefinitions>
            <DockPanel Grid.Row="0">
                <Menu DockPanel.Dock="Top">
                    <MenuItem Header="Options">
                        <MenuItem Header="Algorithm type">
                            <MenuItem Header="Genetic"/>
                            <MenuItem Header="Linear"/>
                        </MenuItem>
                        <MenuItem Header="Number chromosomes "/>
                        <MenuItem Header="Number iterations "/>
                        <MenuItem Header="Elitism percent"/>
                        <MenuItem Header="Mutation rate "/>
                        <MenuItem Header="Number chromosomes "/>
                        <MenuItem Header="Initial population "/>
                        <MenuItem Header="Number chromosomes "/>
                        <Separator/>
                        <MenuItem Header="Exit"/>
                    </MenuItem>
                </Menu>
            </DockPanel>
            <StackPanel Grid.Row="1" DockPanel.Dock="Top" Margin="10,10,10,0">
                <Expander IsExpanded="False" Header="Widgets" Foreground="Black" Margin="10,5">
                    <DockPanel>
                        <Grid Width="Auto">
                            <TextBlock TextWrapping="WrapWithOverflow">
					 <Grid >
                         <!--<StackPanel>
                             <ItemsControl  ItemsSource="{Binding windspeed}"
									ItemTemplate="{StaticResource MetroChartTemplate}">
						
							    <ItemsControl.ItemsPanel>
							        <ItemsPanelTemplate>
								        <WrapPanel IsItemsHost="True" Orientation="Horizontal" />
							        </ItemsPanelTemplate>
								
						        </ItemsControl.ItemsPanel>
						
					        </ItemsControl>
                         </StackPanel>-->
                          
                
                        <Grid.OpacityMask>
                            <VisualBrush Visual="{ Binding ElementName=BorderG2 }"/>
                        </Grid.OpacityMask>
                        <Border x:Name="BorderG2" CornerRadius="15" Opacity="0.3" Background="#212F3C"/>

                        <MetroChart:RadialGaugeChart Background="{x:Null}" ChartTitle="CO2 reduction" ChartSubTitle=""  Foreground="Black" FontSize="7"  >
                            <MetroChart:RadialGaugeChart.Series>
                                <MetroChart:ChartSeries
                                                    Background="#212F3C"
                                                    DisplayMember="Name"
                                                    ItemsSource="{Binding Path= Windspeed}"
                                                    SeriesTitle="Name"
                                                    ValueMember="Speed" HorizontalAlignment="Center"/>
                            </MetroChart:RadialGaugeChart.Series>
                        </MetroChart:RadialGaugeChart>
                        </Grid>


                            </TextBlock>
                        </Grid>
                    </DockPanel>
                </Expander>
            </StackPanel>
            <StackPanel Grid.Row="2" DockPanel.Dock="Top" Margin="10,10,10,0">
                <Expander IsExpanded="False" Header="Total Generation/Demand graph" Foreground="Black" Margin="10,5">
                    <Grid Width="1000">
                        <TextBlock TextWrapping="WrapWithOverflow">
							<chartingToolkit:Chart Grid.Row="2" Margin="10"  FontWeight="Bold" Style="{StaticResource DashboardChartStyle}" Height="600" Width="810">
						    
								<chartingToolkit:LineSeries ItemsSource="{Binding Path=DemandList}" 
													DependentValueBinding="{Binding Path=Value}" 
													IndependentValueBinding="{Binding Path=Key}" 
													IsSelectionEnabled="False"
													Style="{StaticResource LineSeriesStyle}"
															Title="Total Demand  ">
									<chartingToolkit:LineSeries.DataPointStyle>
										<Style TargetType="chartingToolkit:LineDataPoint">
											<Setter Property="Background" Value="DarkOrange"/>
											<Setter Property="Template" Value="{StaticResource LineDataPointPowerTemplate}"/>
										</Style>										
									</chartingToolkit:LineSeries.DataPointStyle>
									</chartingToolkit:LineSeries>
								
								<chartingToolkit:LineSeries ItemsSource="{Binding Path=GenerationList}" 
													DependentValueBinding="{Binding Path=Value}" 
													IndependentValueBinding="{Binding Path=Key}"
													IsSelectionEnabled="False"
													Style="{StaticResource LineSeriesStyle}"
													Title="Total Generation" Margin="0,10,0,0" 
													>
									<chartingToolkit:LineSeries.DataPointStyle>
										<Style TargetType="chartingToolkit:LineDataPoint">
											<Setter Property="Background" Value="DarkGreen"/>
											<Setter Property="Template" Value="{StaticResource LineDataPointPowerTemplate}"/>
										</Style>
										
									</chartingToolkit:LineSeries.DataPointStyle>
									
									<chartingToolkit:LineSeries.IndependentAxis>									
										<chartingToolkit:DateTimeAxis   ShowGridLines="True" GridLineStyle="{StaticResource lineStyle}" Orientation="X" Title="Time (s)" Foreground="Black" FontWeight="Bold" />
									<!--IntervalType="Seconds" Interval="2" Minimum="0:00:00" Maximum="0:00:15" AxisLabelStyle="{DynamicResource DateTimeAxisLabelStyle2}"-->
									</chartingToolkit:LineSeries.IndependentAxis>

									<chartingToolkit:LineSeries.DependentRangeAxis>
										<chartingToolkit:LinearAxis ShowGridLines="True" GridLineStyle="{StaticResource lineStyle}" Orientation="Y" Title="Power (mW)" Minimum="0" Foreground="Black" FontWeight="Bold"/>
									</chartingToolkit:LineSeries.DependentRangeAxis>
								</chartingToolkit:LineSeries>
							</chartingToolkit:Chart>

                        </TextBlock>
                    </Grid>
                </Expander>
            </StackPanel>
            <StackPanel Grid.Row="3" DockPanel.Dock="Top" Margin="10,10,10,0">

                <Expander IsExpanded="False" Header="Generation graphs" Foreground="Black" Margin="10,5">
                    <StackPanel>
                        <DockPanel>
                            <GroupBox Header="Generators" Foreground="Black" Height="400" VerticalAlignment="Top">
                                <ScrollViewer VerticalScrollBarVisibility="Auto" VerticalAlignment="Top" Width="150" HorizontalScrollBarVisibility="Auto" MaxHeight="300">
                                    <ItemsControl ItemsSource="{Binding GeneratorsContainer}"
										  ItemTemplate="{StaticResource VisibilityCheckbox}" />
                                </ScrollViewer>
                            </GroupBox>
                            <ItemsControl  ItemsSource="{Binding GeneratorsContainer}"
									ItemTemplate="{StaticResource GraphGeneratorTemplate}">

                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel IsItemsHost="True" Orientation="Horizontal" />
                                    </ItemsPanelTemplate>

                                </ItemsControl.ItemsPanel>

                            </ItemsControl>

                        </DockPanel>
                    </StackPanel>
                </Expander>
            </StackPanel>

        </Grid>
    </ScrollViewer>
</UserControl>
